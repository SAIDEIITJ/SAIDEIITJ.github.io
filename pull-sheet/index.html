---
layout: subdefault
title: Update faculity
---

<!--These are JavaScript Libraries-->
<!-- <script type="text/javascript" src="https://requirejs.org/docs/release/2.3.5/minified/require.js"></script> -->

<script type="text/javascript" src="papaparse.min.js"></script> <!-- https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js -->
<script type="text/javascript" src="js-yaml.min.js"></script> <!-- https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js -->
<script type="text/javascript" src="github.js"></script>

<h1>Update</h1>
<script type="text/javascript">

    // dict of all published sheets and corresponding resource names
    var $resources = {
        team: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSlkUKS3F0ObI73MPs3bprVyNBKN6RqINtipRkELpaTGrC2qMVvR6SyUgoAvSKPX1YHdfS3fyEF9Ni8/pub?output=tsv',
        news_events: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSYZExFU_O-a7QMx7bSMCOUsz8kjEErd3RVnlfIld1MYN40IpKoxYVuyxEesJvbimzKOKpVDE4FgbCC/pub?output=tsv',
        publications: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTfOI9X3ROPtgANe0F_yYO70G2ITT3ymyrCtriG3IZXfBeHpkr7yuTY7eshCf_hasVu5LLDV50I-sJF/pub?gid=2127468410&single=true&output=tsv',
        links:'https://docs.google.com/spreadsheets/d/e/2PACX-1vTfOI9X3ROPtgANe0F_yYO70G2ITT3ymyrCtriG3IZXfBeHpkr7yuTY7eshCf_hasVu5LLDV50I-sJF/pub?gid=1206947112&single=true&output=tsv',
        faqs:'https://docs.google.com/spreadsheets/d/e/2PACX-1vTfOI9X3ROPtgANe0F_yYO70G2ITT3ymyrCtriG3IZXfBeHpkr7yuTY7eshCf_hasVu5LLDV50I-sJF/pub?gid=1456991437&single=true&output=tsv',
        administration:'https://docs.google.com/spreadsheets/d/e/2PACX-1vTfOI9X3ROPtgANe0F_yYO70G2ITT3ymyrCtriG3IZXfBeHpkr7yuTY7eshCf_hasVu5LLDV50I-sJF/pub?gid=728873275&single=true&output=tsv',
        students:'https://docs.google.com/spreadsheets/d/e/2PACX-1vTfOI9X3ROPtgANe0F_yYO70G2ITT3ymyrCtriG3IZXfBeHpkr7yuTY7eshCf_hasVu5LLDV50I-sJF/pub?gid=1554989096&single=true&output=tsv',
        programs:'https://docs.google.com/spreadsheets/d/e/2PACX-1vTfOI9X3ROPtgANe0F_yYO70G2ITT3ymyrCtriG3IZXfBeHpkr7yuTY7eshCf_hasVu5LLDV50I-sJF/pub?gid=668775554&single=true&output=tsv',
        events:'https://docs.google.com/spreadsheets/d/e/2PACX-1vTfOI9X3ROPtgANe0F_yYO70G2ITT3ymyrCtriG3IZXfBeHpkr7yuTY7eshCf_hasVu5LLDV50I-sJF/pub?gid=1893940642&single=true&output=tsv'
    }

    var header_maps = {
        team: {
            "Acknowledgement": "acknowledgement",
            "Department / Center / School": "affiliation",
            "Faculity?": "faculty",
            "Subfaculty": "subfaculty",
            "Staff?": "staff",
            "Short bio 1": "bio1",
            "Short bio 2": "bio2",
            "Short bio 3": "bio3",
            "Short bio 4": "bio4",
            "Website": "website",
            "Office_number": "office_number",
            "Display?": "display",
            "email": "email",
            "Image": "image",
            "Name": "name",
            "phone": "phone",
            "Position": "position",
            "Timestamp": "timestamp",
            "Year of joining": "year",
            "Primary Affiliation": "primaryaffiliation"
        },
        news_events: {
            "Id": "id",
            "Title": "title",
            "Date": "date",
            "News?": "news",
            "Event?": "event",
            "Graphic": "graphic",
            "Content": "content",
            "Link": "link",
            "Visibility?": "visibility"
        },
        publications: {
            "Timestamp": "timestamp",
            "Journal": "journal",
            "Title": "title",
            "SAIDE Author 1": "author1",
            "Date": "date",
            "Link": "link",
            "Authors": "author",
            "Image": "image"
        },
        links: {
            "Page": "page",
            "Name": "name",
            "URL": "url"
        },
        faqs: {
            "Category": "category",
            "Question": "question",
            "Answer": "answer",
            "Visible": "visible"
        },
        administration: {
            "Position": "position",
            "Entry": "entry",
            "Link": "link"
        },
        students: {
            "Timestamp": "timestamp",
            "Name": "name",
            "Program": "program",
            "Specialization": "specialization",
            "Center": "center",
            "Email": "email",
            "ResearchArea": "researchArea",
            "Supervisor": "supervisor",
            "SecondSupervisor": "secondSupervisor",
            "HighestQualification": "highestQualification",
            "Website": "website",
            "ProfilePhoto": "profilePhoto",
            "Hidden": "hidden",
            "Alumnus": "alumnus"
        },
        programs: {
            "Timestamp": "timestamp",
            "Name": "name",
            "OfferedBy": "offered",
            "Level": "level",
            "Coordinator": "coordinator",
            "URL": "url",
            "Document": "document",
            "Background": "background",
            "Deadline": "deadline",
            "Application": "application"
        },
        events: {
            "Timestamp": "id",
            "Name": "name",
            "Start": "start",
            "End": "end",
            "Description": "description",
            "Type": "type",
            "Banner": "banner",
            "Preset": "preset",
            "TileBackground": "tileBackground",
            "Registration": "registration",
            "Schedule": "schedule",
            "Location": "location",
            "People": "people",
            "Sponsors": "sponsors",
            "Contact": "contact",
            "Hidden": "hidden"
        }


    }

    // some constants related to gh-pages repository
    var $org = 'sw509073';
    var $repo = 'SAIDE_main';
    var $branch = 'main';
    
    // this function extracts parameters from the URL to pass on to the javascript
    function getUrlVar(key){
        var result = new RegExp(key + "=([^&]*)", "i").exec(window.location.search);
        return result && unescape(result[1]) || "";
    }

    function getGDriveDlURL(url){
        // reference: https://github.com/UltiRequiem/drive_link/blob/main/mod.ts
        const regexp = /https:\/\/drive\.google\.com\/file\/d\/(?<id>[^/]+)\/view\?usp=sharing/;
        if (regexp.test(url)) {
            const res = regexp.exec(url);
            var id = res?.groups?.id;
            return `https://drive.google.com/thumbnail?id=${id.trim()}&sz=w300`
        }
        return url;
    }

    function getGDriveOURL(url) {
    // Regular expression to match Google Drive open links
        const regexp = /https:\/\/drive\.google\.com\/open\?id=(?<id>[^&]+)/;
        if (regexp.test(url)) {
            const res = regexp.exec(url);
            var id = res?.groups?.id;
            return `https://drive.google.com/thumbnail?id=${id.trim()}&sz=w300`;
        }
        return url;
}

    // extract parameters that need to be passed and should not be saved
    var $GHToken = getUrlVar('ghtoken');

    // variables that we will need later
    var $yaml_store = "";
    // var $resource = "";

    function init() {
        $.each($resources, function(name, url) {
            // $resource = name;
            function cb(results) {
                showInfo(results, name);
            }

            function map_header(header, index) {
                return header_maps[name][header];
            }

            function map_values(value, header) {
                if ( header == "image" ) {return getGDriveDlURL(value);}
                if ( header == "display") {return parseInt(value);}
                if ( header == "staff") {return parseInt(value);}
                if ( header == "view") {return parseInt(value);}
                if ( header == "faculty") {return parseInt(value);}
                if ( header == "graphic" ) {return getGDriveDlURL(value);}
                if ( header == "news") {return parseInt(value);}
                if ( header == "event") {return parseInt(value);}
                if ( header == "visibility") {return parseInt(value);}
                if ( header == "hidden") {return parseInt(value);}
                if ( header == "alumnus") {return parseInt(value);}
                if ( header == "profilePhoto" ) {return getGDriveOURL(value);}
                if ( header == "background" ) {return getGDriveOURL(value);}
                
                return value;
            }

            Papa.parse(url, {
                delimiter: "\t",
                download: true,
                skipEmptyLines: 'greedy',
                dynamicTyping: 'true',
                header: true,
                transformHeader: map_header,
                transform: map_values,
                complete: cb
            });
        });
    };

    window.addEventListener('DOMContentLoaded', init)

    function showInfo(results, $resource) {
        // var GitHub = require('github-api');
        var data = results.data;

if (data.length === 0) {
    console.warn("No data found for", $resource);
    return;
}
alert("Successfully processed " + data.length + " rows for " + $resource + "!")

// Convert data to YAML format
var $items = data.map(function(service) {
        var $p = {};
        Object.keys(service).forEach(function($key) {
            $p[$key] = service[$key];
        });
        return $p;
    });

    var $yaml_dump = jsyaml.dump($items);
    document.getElementById('source').value = $yaml_dump;

    var github = new Github({ token: $GHToken, auth: "oauth" });
    var repo = github.getRepo($org, $repo);
    var $writepath = '_data/';

    if ($resource === 'news_events') {
        $writepath += 'news_events.yaml';
    } else if ($resource === 'team') {
        $writepath += 'team.yaml';
    } else if ($resource === 'publications') {
        $writepath += 'publications.yaml';
    } else if ($resource === 'links') {
        $writepath += 'links.yaml';
    } else if ($resource === 'faqs') {
        $writepath += 'faqs.yaml';
    } else if ($resource === 'administration') {
        $writepath += 'administration.yaml';
    } else if ($resource === 'students') {
        $writepath += 'students.yaml';
    } else if ($resource === 'programs') {
        $writepath += 'programs.yaml';
    } else if ($resource === 'events') {
        $writepath += 'events.yaml';
    }

    // Fetch existing content from GitHub
    repo.read($branch, $writepath, function(err, existingContent) {
        if (err) {
            console.error("Error reading existing content from GitHub:", err);
            return;
        }

        var existingYAML = existingContent.data;
        if (existingYAML === $yaml_dump) {
            console.log($resource + " is unchanged. Skipping update.");
            return;
        }

        // Fetch the latest SHA for the file to handle potential conflicts
        repo.getSha($branch, $writepath, function(err, sha) {
            if (err) {
                console.error("Error getting SHA for the file from GitHub:", err);
                return;
            }

            // Write updated content to GitHub
            repo.write($branch, $writepath, $yaml_dump, 'Update ' + $resource, { sha: sha }, function(err) {
                if (err) {
                    console.error("Error writing to GitHub:", err);
                } else {
                    console.log("Successfully updated " + $resource);
                }
            });
        });
    });
}
Explanation
</script>
<textarea cols="10" rows="5" id="source" style="border: 1px solid #000; width: 100%; height: 500px;"></textarea>